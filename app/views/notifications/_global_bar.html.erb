<%
  show_global_bar ||= true # Toggles the appearance of the global bar
  title = "Coronavirus (COVID-19): what you need to do"
  title_href = "/coronavirus"
  link_text = false
  link_href = false

  # Toggles the banner to have a red background and white text.
  warning ||= true

  # Toggles banner being permanently visible
  # If true, banner is always_visible & does not disappear automatically after 3 pageviews
  # Regardless of value, banner is always manually dismissable by users
  always_visible = true

  global_bar_classes = %w(global-bar dont-print)
  global_bar_classes << "global-bar--warning" if warning

  title_classes = %w(global-bar-title)
  title_classes << "js-call-to-action" if title_href
  title_classes << "govuk-link" if title_href && !warning

  dismiss_classes = %w(global-bar__dismiss dismiss)
  dismiss_classes << "govuk-link" unless warning

-%>

<% if show_global_bar %>
  <% content_for :body_end do %>
    <%= javascript_include_tag 'global-bar-init', integrity: false %>
    <script>
      if (GOVUK.globalBarInit) {
        window.GOVUK.globalBarInit.init()
      }
    </script>
  <% end %>
  <!--[if gt IE 7]><!-->
  <div id="global-bar" class="<%= global_bar_classes.join(' ') %>" data-module="global-bar" <%= "data-global-bar-permanent=true" if always_visible %>>
    <div class="global-bar-message-container">
    <p class="global-bar-message">
      <% if title %>
        <% if title_href %>
          <a class="<%= title_classes.join(' ') %>" href="<%= title_href %>"><%= title %></a>
        <% else %>
          <span class="<%= title_classes.join(' ') %>"><%= title %></span>
        <% end %>
      <% end %>

      <% if link_text %>
        <% if link_href %>
          <%= link_to(
            link_text,
            link_href,
            rel: "external noreferrer",
            class: "govuk-link js-call-to-action"
          ) %>
        <% else %>
          <span><%= link_text %></span>
        <% end %>
      <% end %>
    </p>
    <a href="#hide-message"
       class="<%= dismiss_classes.join(' ') %>"
       role="button"
       aria-controls="global-bar">Hide&nbsp;message</a>
    </div>
  </div>
  <!--<![endif]-->
<% end %>
